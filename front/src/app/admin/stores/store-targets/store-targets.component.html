<div class="space-y-6">
  <div class="flex justify-between items-center">
    <div class="flex items-center gap-4">
      <button
        type="button"
        (click)="onBack()"
        class="px-3 py-2 text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors flex items-center gap-2"
      >
        <mat-icon class="text-base">arrow_back</mat-icon>
        Back
      </button>
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Store Targets</h1>
        @if (store()) {
        <p class="text-sm text-gray-600 mt-1">{{ store()?.name }}</p>
        }
      </div>
    </div>
    <button
      type="button"
      (click)="onAdd()"
      class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors flex items-center gap-2"
    >
      <mat-icon class="text-lg">add</mat-icon>
      Add Target
    </button>
  </div>

  <!-- Filters -->
  <div class="bg-white p-4 rounded-lg shadow space-y-4">
    <div class="flex items-center gap-4 flex-wrap">
      <div class="flex items-center gap-2">
        <label for="period-type-filter" class="text-sm font-medium text-gray-700"
          >Period Type:</label
        >
        <select
          id="period-type-filter"
          [value]="periodTypeFilter()"
          (change)="onPeriodTypeFilterChange($any($event.target).value)"
          class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option value="">All</option>
          <option value="daily">Daily</option>
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
          <option value="yearly">Yearly</option>
        </select>
      </div>
      <div class="flex items-center gap-2">
        <label for="metric-type-filter" class="text-sm font-medium text-gray-700"
          >Metric Type:</label
        >
        <select
          id="metric-type-filter"
          [value]="metricTypeFilter()"
          (change)="onMetricTypeFilterChange($any($event.target).value)"
          class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option value="">All</option>
          <option value="customer_visits">Customer Visits</option>
          <option value="orders">Orders</option>
          <option value="revenue">Revenue</option>
        </select>
      </div>
      <div class="flex items-center gap-2">
        <label for="status-filter" class="text-sm font-medium text-gray-700">Status:</label>
        <select
          id="status-filter"
          [value]="statusFilter()"
          (change)="onStatusFilterChange($any($event.target).value)"
          class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option value="">All</option>
          <option value="active">Active</option>
          <option value="completed">Completed</option>
          <option value="cancelled">Cancelled</option>
        </select>
      </div>
      @if (hasActiveFilters()) {
      <button
        type="button"
        (click)="clearFilters()"
        class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors flex items-center gap-2"
      >
        <mat-icon class="text-base">clear</mat-icon>
        Clear Filters
      </button>
      }
    </div>
  </div>

  <!-- Targets Table -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Metric Type
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Period Type
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Target Value
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Period Start
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Period End
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Status
            </th>
            <th
              class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"
            >
              Actions
            </th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          @if (loading()) {
          <tr>
            <td colspan="7" class="px-6 py-4 text-center text-gray-500">Loading targets...</td>
          </tr>
          } @else if (targets().length === 0) {
          <tr>
            <td colspan="7" class="px-6 py-4 text-center text-gray-500">No targets found</td>
          </tr>
          } @else { @for (target of targets(); track target.id) {
          <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
              {{ getMetricTypeLabel(target.metric_type) }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ getPeriodTypeLabel(target.period_type) }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ target.target_value }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ target.period_start }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
              {{ target.period_end || 'N/A' }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
              <span
                class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                [class.bg-green-100]="target.status === 'active'"
                [class.text-green-800]="target.status === 'active'"
                [class.bg-blue-100]="target.status === 'completed'"
                [class.text-blue-800]="target.status === 'completed'"
                [class.bg-red-100]="target.status === 'cancelled'"
                [class.text-red-800]="target.status === 'cancelled'"
              >
                {{ target.status }}
              </span>
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
              <button
                type="button"
                (click)="onEdit(target)"
                class="text-blue-600 hover:text-blue-900 mr-4 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded flex items-center gap-1 inline-flex"
              >
                <mat-icon class="text-base">edit</mat-icon>
                Edit
              </button>
              <button
                type="button"
                (click)="onDelete(target)"
                class="text-red-600 hover:text-red-900 focus:outline-none focus:ring-2 focus:ring-red-500 rounded flex items-center gap-1 inline-flex"
              >
                <mat-icon class="text-base">delete</mat-icon>
                Delete
              </button>
            </td>
          </tr>
          } }
        </tbody>
      </table>
    </div>
  </div>
</div>

@if (showForm()) {
<app-store-target-form
  [storeId]="storeId()"
  [target]="editingTarget()"
  (close)="onFormClose()"
  (saved)="onFormSave()"
/>
}

<app-confirm-dialog
  [isOpen]="showDeleteDialog()"
  title="Delete Target"
  [message]="'Are you sure you want to delete this target? This action cannot be undone.'"
  (confirmed)="onDeleteConfirm()"
  (cancelled)="onDeleteCancel()"
/>
